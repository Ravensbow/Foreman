@inject IComponentService ComponentService
@inject IHttpClientFactory http

@dynamicComponent()

@code {
    [Parameter]
    public int PluginId { get; set; }
    [Parameter]
    public int InstanceId { get; set; }

    string componentName;
    HttpClient? httpClient;

    protected override async Task OnInitializedAsync()
    {
        httpClient = http.CreateClient("Foreman.ServerAPI");
        var response = await httpClient.GetAsync($"Plugin/PluginNameById/{PluginId}");
        if (!response.IsSuccessStatusCode)
        {
            //TODO: Komunikat
            return;
        }
        componentName = await response.Content.ReadFromJsonAsync<string>();

    }

    RenderFragment dynamicComponent() => builder =>
    {
        System.Diagnostics.Debug.WriteLine("Elo elo:" + componentName);
        var component = ComponentService.GetComponentByName("displayedtext" + "instance");
        builder.OpenComponent(0,component.Component);

        for (int i = 0; i < component.Parameters.Count; i++)
        {
            var attribute = component.Parameters.ElementAt(i);
            builder.AddAttribute(i+1,attribute.Key,attribute.Value);
        }
        builder.AddAttribute(component.Parameters.Count, "InstanceId", InstanceId);
        builder.CloseComponent();
    };
}
